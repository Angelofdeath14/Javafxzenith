<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.paint.Color?>
<?import javafx.scene.shape.Rectangle?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="tn.esprit.controller.EvenementsController"
            prefHeight="800.0" prefWidth="1200.0"
            style="-fx-background-color: linear-gradient(to bottom, #f5f7fa, #e4e7eb);">

    <!-- En-tête -->
    <top>
        <VBox spacing="10" style="-fx-background-color: #2c3e50; -fx-padding: 15;">
            <HBox alignment="CENTER" spacing="15">
                <ImageView fitHeight="50" fitWidth="50" preserveRatio="true">
                    <Image url="@/img/logo-artphoria.png"/>
                </ImageView>
                <Label text="Artphoria" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                <HBox HBox.hgrow="ALWAYS" />
                <Button text="Accueil" styleClass="nav-button" 
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-weight: bold;"/>
                <Button text="Événements" styleClass="nav-button" 
                        style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold;"/>
                <Button text="Mon Compte" styleClass="nav-button"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-weight: bold;"/>
                <Button text="Contact" styleClass="nav-button"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-weight: bold;"/>
            </HBox>
            
            <HBox alignment="CENTER" spacing="20" style="-fx-padding: 20 0 10 0;">
                <Label text="Découvrez nos événements" 
                     style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            </HBox>
            
            <!-- Barre de recherche et filtres -->
            <HBox spacing="10" alignment="CENTER" style="-fx-padding: 10 0;">
                <TextField fx:id="searchField" promptText="Rechercher un événement..."
                         style="-fx-min-width: 300; -fx-padding: 8; -fx-background-radius: 20;"/>
                <ComboBox fx:id="filterCategory" promptText="Catégorie" 
                         style="-fx-min-width: 150; -fx-background-radius: 20;"/>
                <ComboBox fx:id="filterDate" promptText="Date" 
                         style="-fx-min-width: 150; -fx-background-radius: 20;"/>
                <Button text="Rechercher" 
                        style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 20; -fx-padding: 8 15;"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- Barre latérale -->
    <left>
        <VBox spacing="10" style="-fx-background-color: #34495e; -fx-padding: 20; -fx-min-width: 200;">
            <Label text="ADMINISTRATION" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            
            <Separator style="-fx-background-color: #4a6278;"/>
            
            <Button fx:id="btnAddEvent" text="Ajouter événement" onAction="#showAddEventView"
                    style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5; -fx-min-width: 160; -fx-padding: 10;">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/images/add-icon.png"/>
                    </ImageView>
                </graphic>
            </Button>
            
            <Button fx:id="btnListSessions" text="Liste des sessions" onAction="#showSessionsListView"
                    style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5; -fx-min-width: 160; -fx-padding: 10;">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/images/session-icon.png"/>
                    </ImageView>
                </graphic>
            </Button>
            
            <Button fx:id="btnListEvents" text="Liste événements" onAction="#showEventsListView"
                    style="-fx-background-color: #2ecc71; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5; -fx-min-width: 160; -fx-padding: 10;">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/images/list-icon.png"/>
                    </ImageView>
                </graphic>
            </Button>
            
            <Button fx:id="btnUserMode" text="Mode utilisateur" onAction="#showUserView"
                    style="-fx-background-color: #9b59b6; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5; -fx-min-width: 160; -fx-padding: 10;">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/images/user-icon.png"/>
                    </ImageView>
                </graphic>
            </Button>
            
            <Region VBox.vgrow="ALWAYS" />
            
            <Label text="STATISTIQUES" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            
            <Separator style="-fx-background-color: #4a6278;"/>
            
            <VBox style="-fx-background-color: rgba(255,255,255,0.1); -fx-padding: 10; -fx-background-radius: 5;">
                <Label text="Total événements" style="-fx-text-fill: #bdc3c7;"/>
                <Label fx:id="lblTotalEvents" text="0" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            </VBox>
            
            <VBox style="-fx-background-color: rgba(255,255,255,0.1); -fx-padding: 10; -fx-background-radius: 5;">
                <Label text="Sessions actives" style="-fx-text-fill: #bdc3c7;"/>
                <Label fx:id="lblActiveSessions" text="0" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            </VBox>
        </VBox>
    </left>
    
    <!-- Contenu principal -->
    <center>
        <StackPane>
            <!-- Vue utilisateur (cartes d'événements) -->
            <ScrollPane fx:id="userView" fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;">
                <VBox spacing="30" style="-fx-padding: 30;">
                    <!-- Événements à la une -->
                    <VBox spacing="15">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Événements à la une" 
                                style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <HBox HBox.hgrow="ALWAYS" />
                            <Button text="Voir tout" 
                                    style="-fx-background-color: transparent; -fx-text-fill: #3498db; -fx-font-weight: bold;"/>
                        </HBox>
                        
                        <FlowPane fx:id="featuredEventsContainer" hgap="20" vgap="20">
                            <!-- Les événements à la une seront ajoutés dynamiquement -->
                        </FlowPane>
                    </VBox>
                    
                    <!-- Tous les événements -->
                    <VBox spacing="15">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Tous les événements" 
                                style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <HBox HBox.hgrow="ALWAYS" />
                            <ComboBox promptText="Trier par" 
                                    style="-fx-background-radius: 20;"/>
                        </HBox>
                        
                        <FlowPane fx:id="eventsContainer" hgap="20" vgap="20">
                            <!-- Les événements seront ajoutés dynamiquement -->
                        </FlowPane>
                    </VBox>
                </VBox>
            </ScrollPane>
            
            <!-- Vue liste d'événements (admin) -->
            <VBox fx:id="adminListView" visible="false" style="-fx-padding: 20;" spacing="15">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="Liste des événements" 
                         style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                    <Region HBox.hgrow="ALWAYS" />
                    <Button text="+ Nouvel événement" fx:id="btnNewFromList"
                          style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5;"/>
                </HBox>
                
                <TableView fx:id="eventsTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colId" text="ID" prefWidth="50" />
                        <TableColumn fx:id="colTitle" text="Titre" prefWidth="200" />
                        <TableColumn fx:id="colCategory" text="Catégorie" prefWidth="100" />
                        <TableColumn fx:id="colDate" text="Date" prefWidth="150" />
                        <TableColumn fx:id="colLocation" text="Lieu" prefWidth="120" />
                        <TableColumn fx:id="colCapacity" text="Places" prefWidth="80" />
                        <TableColumn fx:id="colActions" text="Actions" prefWidth="180" />
                    </columns>
                </TableView>
            </VBox>
            
            <!-- Vue liste des sessions (admin) -->
            <VBox fx:id="adminSessionsView" visible="false" style="-fx-padding: 20;" spacing="15">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="Liste des sessions" 
                         style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                    <Region HBox.hgrow="ALWAYS" />
                    <Button text="+ Nouvelle session" fx:id="btnNewSession"
                          style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5;"/>
                </HBox>
                
                <TableView fx:id="sessionsTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colSessionId" text="ID" prefWidth="50" />
                        <TableColumn fx:id="colSessionTitle" text="Titre" prefWidth="180" />
                        <TableColumn fx:id="colSessionEvent" text="Événement" prefWidth="180" />
                        <TableColumn fx:id="colSessionDate" text="Date" prefWidth="120" />
                        <TableColumn fx:id="colSessionTime" text="Horaire" prefWidth="120" />
                        <TableColumn fx:id="colSessionCapacity" text="Places" prefWidth="80" />
                        <TableColumn fx:id="colSessionActions" text="Actions" prefWidth="150" />
                    </columns>
                </TableView>
            </VBox>
            
            <!-- Vue ajout d'événement (admin) -->
            <VBox fx:id="adminAddView" visible="false" style="-fx-padding: 20;" spacing="15">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="Ajouter un événement" 
                         style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                </HBox>
                
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                    <VBox spacing="20" style="-fx-padding: 20; -fx-background-color: white; -fx-background-radius: 10;">
                        <GridPane hgap="20" vgap="15">
                            <columnConstraints>
                                <ColumnConstraints hgrow="NEVER" minWidth="100" prefWidth="150" />
                                <ColumnConstraints hgrow="ALWAYS" minWidth="200" />
                            </columnConstraints>
                            
                            <!-- Titre -->
                            <Label text="Titre:" GridPane.rowIndex="0" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <TextField fx:id="fieldTitle" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                            
                            <!-- Catégorie -->
                            <Label text="Catégorie:" GridPane.rowIndex="1" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="fieldCategory" GridPane.rowIndex="1" GridPane.columnIndex="1"
                                    prefWidth="200"/>
                            
                            <!-- Date début -->
                            <Label text="Date début:" GridPane.rowIndex="2" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="fieldStartDate" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                            
                            <!-- Date fin -->
                            <Label text="Date fin:" GridPane.rowIndex="3" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="fieldEndDate" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                            
                            <!-- Lieu -->
                            <Label text="Lieu:" GridPane.rowIndex="4" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <TextField fx:id="fieldLocation" GridPane.rowIndex="4" GridPane.columnIndex="1"/>
                            
                            <!-- Places -->
                            <Label text="Nombre places:" GridPane.rowIndex="5" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <TextField fx:id="fieldCapacity" GridPane.rowIndex="5" GridPane.columnIndex="1"/>
                            
                            <!-- Image -->
                            <Label text="Image:" GridPane.rowIndex="6" GridPane.columnIndex="0"
                                 style="-fx-font-weight: bold;"/>
                            <HBox spacing="10" GridPane.rowIndex="6" GridPane.columnIndex="1">
                                <TextField fx:id="fieldImage" HBox.hgrow="ALWAYS"/>
                                <Button text="Parcourir" fx:id="btnBrowseImage"/>
                            </HBox>
                        </GridPane>
                        
                        <!-- Description -->
                        <Label text="Description:" style="-fx-font-weight: bold;"/>
                        <TextArea fx:id="fieldDescription" wrapText="true" prefHeight="100"/>
                        
                        <!-- Boutons -->
                        <HBox spacing="10" alignment="CENTER_RIGHT">
                            <Button text="Annuler" fx:id="btnCancelAdd"
                                  style="-fx-background-color: #95a5a6; -fx-text-fill: white;"/>
                            <Button text="Enregistrer" fx:id="btnSaveEvent"
                                  style="-fx-background-color: #2ecc71; -fx-text-fill: white; -fx-font-weight: bold;"/>
                        </HBox>
                    </VBox>
                </ScrollPane>
            </VBox>
        </StackPane>
    </center>
    
    <!-- Pied de page -->
    <bottom>
        <VBox style="-fx-background-color: #2c3e50; -fx-padding: 20;">
            <HBox alignment="CENTER" spacing="20">
                <Label text="© 2025 Artphoria - Tous droits réservés" style="-fx-text-fill: white;"/>
                <Label text="Mentions légales" style="-fx-text-fill: #bdc3c7; -fx-underline: true;"/>
                <Label text="Politique de confidentialité" style="-fx-text-fill: #bdc3c7; -fx-underline: true;"/>
                <Label text="Contact" style="-fx-text-fill: #bdc3c7; -fx-underline: true;"/>
            </HBox>
        </VBox>
    </bottom>

    <!-- Template pour les cartes d'événements -->
    <fx:define>
        <VBox fx:id="eventCardTemplate" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 10);" prefWidth="350" prefHeight="450">
            <!-- Bannière avec image -->
            <StackPane>
                <!-- Rectangle pour l'effet d'assombrissement -->
                <Rectangle width="350" height="200" fill="black" opacity="0.1"/>
                
                <!-- Image de l'événement -->
                <ImageView fx:id="eventImage" fitWidth="350" fitHeight="200" preserveRatio="true"/>
                
                <!-- Étiquette de catégorie -->
                <HBox alignment="TOP_LEFT" StackPane.alignment="TOP_LEFT">
                    <Label fx:id="eventCategory" text="Concert" 
                         style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 5 10; -fx-background-radius: 0 0 5 0;">
                        <HBox.margin>
                            <Insets top="0" left="0"/>
                        </HBox.margin>
                    </Label>
                </HBox>
            </StackPane>
            
            <!-- Contenu de la carte -->
            <VBox spacing="10" VBox.vgrow="ALWAYS" style="-fx-padding: 15;">
                <!-- Titre -->
                <Label fx:id="eventTitle" text="Titre de l'événement" wrapText="true"
                     style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                
                <!-- Détails -->
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/images/calendar-icon.png"/>
                    </ImageView>
                    <Label fx:id="eventDate" text="12-15 Avril 2025" style="-fx-text-fill: #7f8c8d;"/>
                </HBox>
                
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/images/location-icon.png"/>
                    </ImageView>
                    <Label fx:id="eventLocation" text="Tunis, Tunisie" style="-fx-text-fill: #7f8c8d;"/>
                </HBox>
                
                <!-- Description courte -->
                <Label fx:id="eventDescription" text="Description courte de l'événement qui donne un aperçu de ce qui est proposé..." 
                     wrapText="true" style="-fx-text-fill: #7f8c8d;" maxHeight="60"/>
                
                <!-- Places disponibles -->
                <HBox alignment="CENTER_LEFT" spacing="5">
                    <Label text="Places disponibles:" style="-fx-text-fill: #7f8c8d;"/>
                    <Label fx:id="eventCapacity" text="120" style="-fx-text-fill: #27ae60; -fx-font-weight: bold;"/>
                </HBox>
                
                <Region VBox.vgrow="ALWAYS" /> <!-- Spacer -->
                
                <!-- Boutons d'action -->
                <HBox spacing="10" alignment="CENTER">
                    <Button fx:id="viewSessionsButton" text="Voir les sessions" 
                          style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-min-width: 150px; -fx-background-radius: 5;"/>
                    <Button fx:id="reserveButton" text="Réserver" 
                          style="-fx-background-color: #2ecc71; -fx-text-fill: white; -fx-font-weight: bold; -fx-min-width: 110px; -fx-background-radius: 5;"/>
                </HBox>
            </VBox>
        </VBox>
        
        <!-- Template pour le modal des sessions -->
        <VBox fx:id="sessionModalTemplate" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.3), 20, 0, 0, 20);" prefWidth="600" prefHeight="500">
            <VBox style="-fx-background-color: #3498db; -fx-padding: 15; -fx-background-radius: 10 10 0 0;">
                <Label fx:id="sessionEventTitle" text="Sessions de l'événement" 
                     style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            </VBox>
            
            <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
                <VBox fx:id="sessionsContainer" spacing="15" style="-fx-padding: 20;">
                    <!-- Les sessions seront ajoutées dynamiquement -->
                </VBox>
            </ScrollPane>
            
            <HBox alignment="CENTER_RIGHT" style="-fx-padding: 15; -fx-background-color: #f5f5f5; -fx-background-radius: 0 0 10 10;">
                <Button text="Fermer" style="-fx-background-color: #7f8c8d; -fx-text-fill: white;"/>
            </HBox>
        </VBox>
        
        <!-- Template pour une carte de session -->
        <HBox fx:id="sessionCardTemplate" spacing="15" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #e0e0e0; -fx-border-radius: 5;">
            <ImageView fx:id="sessionImage" fitWidth="80" fitHeight="80" preserveRatio="true"/>
            
            <VBox spacing="5" HBox.hgrow="ALWAYS">
                <Label fx:id="sessionTitle" text="Titre de la session" 
                     style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                <Label fx:id="sessionDateTime" text="Le 12 avril 2025 de 14h00 à 16h00" 
                     style="-fx-text-fill: #3498db;"/>
                <Label fx:id="sessionDescription" text="Description de la session" wrapText="true"
                     style="-fx-text-fill: #7f8c8d;"/>
                
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label text="Places:" style="-fx-text-fill: #7f8c8d;"/>
                    <Label fx:id="sessionCapacity" text="50" style="-fx-text-fill: #27ae60; -fx-font-weight: bold;"/>
                </HBox>
            </VBox>
            
            <Button fx:id="sessionReserveButton" text="Réserver" 
                  style="-fx-background-color: #2ecc71; -fx-text-fill: white; -fx-font-weight: bold; -fx-min-width: 100px;"/>
        </HBox>
    </fx:define>
</BorderPane> 